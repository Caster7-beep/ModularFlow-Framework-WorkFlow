# ğŸ“œ History Module

## ğŸ¯ æ ¸å¿ƒèŒè´£

`history_module` æ˜¯ä¸€ä¸ªä¸“æ³¨äºç®¡ç†å’ŒæŒä¹…åŒ–**åŸå§‹å¯¹è¯å†å²**çš„æ¨¡å—ã€‚

å®ƒçš„æ ¸å¿ƒè®¾è®¡ç†å¿µæ˜¯**å•ä¸€èŒè´£**å’Œ**æ•°æ®çº¯å‡€**ï¼š

-   **å”¯ä¸€èŒè´£**: åªè´Ÿè´£åŠ è½½ã€ä¿å­˜ã€æ·»åŠ å’Œæ£€ç´¢å¯¹è¯å†å²è®°å½•ã€‚
-   **æ•°æ®çº¯å‡€**: å­˜å‚¨çš„å¯¹è¯å†å²æ˜¯å®Œå…¨åŸå§‹çš„ï¼Œä¸åŒ…å«ä»»ä½•ç»è¿‡å®å¤„ç†ã€ä¸–ç•Œä¹¦æ³¨å…¥æˆ–å…¶ä»–å½¢å¼ä¿®æ”¹çš„å†…å®¹ã€‚å®ƒæ˜¯æ‰€æœ‰åç»­å¤„ç†æµç¨‹çš„èµ·ç‚¹å’Œâ€œäº‹å®æ¥æºâ€ã€‚

## ğŸ“¦ API æ¥å£

æœ¬æ¨¡å—å‘å·¥ä½œæµç³»ç»Ÿæ³¨å†Œäº†ä»¥ä¸‹å‡½æ•°ï¼š

### 1. `history.load_history(file_path: str)`

ä»æŒ‡å®šçš„JSONæ–‡ä»¶åŠ è½½å¯¹è¯å†å²åˆ°å†…å­˜ä¸­ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå†…å­˜ä¸­çš„å†å²å°†ä¸ºç©ºã€‚

-   **è¾“å…¥**:
    -   `file_path` (str): å¯¹è¯å†å²æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚
-   **è¾“å‡º**: æ— ã€‚

### 2. `history.save_history(file_path: str)`

å°†å½“å‰å†…å­˜ä¸­çš„å¯¹è¯å†å²ä»¥JSONæ ¼å¼ä¿å­˜åˆ°æŒ‡å®šæ–‡ä»¶ã€‚

-   **è¾“å…¥**:
    -   `file_path` (str): ä¿å­˜å¯¹è¯å†å²çš„ç›®æ ‡æ–‡ä»¶è·¯å¾„ã€‚
-   **è¾“å‡º**: æ— ã€‚

### 3. `history.add_message(role: str, content: str)`

å‘å†…å­˜ä¸­çš„å¯¹è¯å†å²åˆ—è¡¨è¿½åŠ ä¸€æ¡æ–°æ¶ˆæ¯ã€‚

-   **è¾“å…¥**:
    -   `role` (str): æ¶ˆæ¯çš„è§’è‰²ï¼Œå¿…é¡»æ˜¯ `'user'`, `'assistant'` æˆ– `'system'` ä¹‹ä¸€ã€‚
    -   `content` (str): æ¶ˆæ¯çš„åŸå§‹æ–‡æœ¬å†…å®¹ã€‚
-   **è¾“å‡º**: æ— ã€‚

### 4. `history.get_history() -> Dict[str, Any]`

è·å–å½“å‰å†…å­˜ä¸­çš„å®Œæ•´å¯¹è¯å†å²åˆ—è¡¨ã€‚

-   **è¾“å…¥**: æ— ã€‚
-   **è¾“å‡º**:
    -   `history` (List[Dict[str, str]]): ä¸€ä¸ªåŒ…å«å¯¹è¯å†å²çš„åˆ—è¡¨ï¼Œä¾‹å¦‚ `[{'role': 'user', 'content': '...'}, ...]`ã€‚

### 5. `history.clear_history()`

æ¸…ç©ºå½“å‰å†…å­˜ä¸­çš„æ‰€æœ‰å¯¹è¯å†å²è®°å½•ã€‚

-   **è¾“å…¥**: æ— ã€‚
-   **è¾“å‡º**: æ— ã€‚

## ğŸ’¾ æ•°æ®æ ¼å¼

æœ¬æ¨¡å—ä½¿ç”¨ç®€å•ã€é€šç”¨çš„JSONæ ¼å¼æ¥å­˜å‚¨å¯¹è¯å†å²ã€‚æ–‡ä»¶å†…å®¹æ˜¯ä¸€ä¸ªJSONæ•°ç»„ï¼Œæ¯ä¸ªå¯¹è±¡ä»£è¡¨ä¸€æ¡æ¶ˆæ¯ã€‚

**ç¤ºä¾‹ `conversation_history.json`:**

```json
[
    {
        "role": "user",
        "content": "ä½ å¥½ï¼Œè¿™æ˜¯ä¸€ä¸ªåŸå§‹çš„ç”¨æˆ·è¾“å…¥ã€‚"
    },
    {
        "role": "assistant",
        "content": "ä½ å¥½ï¼Œè¿™æ˜¯ä¸€ä¸ªæœªç»å¤„ç†çš„AIå›å¤ã€‚"
    }
]
```

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹ (åœ¨å·¥ä½œæµä¸­)

```python
# (åœ¨ä¸€ä¸ªå·¥ä½œæµæ–‡ä»¶ä¸­)

# å‡è®¾ registry æ˜¯é€šè¿‡ get_registry() è·å–çš„
registry = get_registry()

# å®šä¹‰å†å²æ–‡ä»¶è·¯å¾„
history_file = "path/to/my_conversation.json"

# 1. åŠ è½½å†å²
registry.call("history.load_history", file_path=history_file)

# 2. æ·»åŠ ä¸€æ¡æ–°æ¶ˆæ¯
registry.call("history.add_message", role="user", content="è¿™æ˜¯æˆ‘çš„æ–°é—®é¢˜ã€‚")

# 3. è·å–å®Œæ•´çš„å†å²è®°å½•ä»¥è¿›è¡Œå¤„ç†
result = registry.call("history.get_history")
current_history = result.get("history")

# ... (åœ¨è¿™é‡Œå¯ä»¥å¯¹ current_history è¿›è¡Œå„ç§å¤„ç†)

# 4. æ·»åŠ AIçš„å›å¤
registry.call("history.add_message", role="assistant", content="è¿™æ˜¯AIçš„å›å¤ã€‚")

# 5. ä¿å­˜æ›´æ–°åçš„å†å²
registry.call("history.save_history", file_path=history_file)